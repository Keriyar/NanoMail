import { LightColors } from "../themes/colors.slint";
import { Badge } from "badge.slint";

// 本地定义 Account 结构体(与 main.slint 保持一致)
struct Account {
    email: string,
    display-name: string,
    avatar-image: image,
    unread-count: int,
    is-loading: bool,
    has-error: bool,
}

export component AccountCard {
    in property <Account> account;
    callback avatar-clicked();

    height: 80px;

    // macOS 风格的悬停背景
    background-rect := Rectangle {
        background: transparent;
        border-radius: 12px;  // macOS 内部组件圆角标准

        animate background {
            duration: 200ms;
            easing: ease-in-out;
        }
    }

    // 触摸区域
    touch-area := TouchArea {
        mouse-cursor: pointer;
    }

    // 悬停状态
    states [
        hover when touch-area.has-hover: {
            background-rect.background: LightColors.button-hover;
        }
        pressed when touch-area.pressed: {
            background-rect.background: LightColors.button-active;
        }
    ]

    HorizontalLayout {
        padding-left: 20px;
        padding-right: 20px;
        spacing: 12px;
        alignment: center;

        // 头像区域
        Rectangle {
            width: 48px;
            height: 48px;
            border-radius: 24px;  // 完美圆形
            border-width: 1px;
            border-color: LightColors.separator;
            clip: true;

            // 轻微阴影增强立体感
            drop-shadow-blur: 8px;
            drop-shadow-color: LightColors.shadow-light;
            drop-shadow-offset-y: 2px;

            // 显示 avatar-image(由 Rust 端提供:实际头像或占位符)
            Image {
                source: account.avatar-image;
                width: 100%;
                height: 100%;
                image-fit: cover;
            }

            avatar-touch := TouchArea {
                mouse-cursor: pointer;
                clicked => { root.avatar-clicked(); }
            }
        }

        // 用户信息区域
        VerticalLayout {
            spacing: 4px;  // macOS 标准间距

            Text {
                text: account.display-name;
                color: LightColors.text-primary;
                font-size: 16px;
                font-weight: 600;  // macOS 标准粗细
                horizontal-alignment: left;
                overflow: elide;
            }

            Text {
                text: account.email;
                color: LightColors.text-secondary;
                font-size: 13px;
                font-weight: 400;
                horizontal-alignment: left;
                overflow: elide;
            }
        }

        // 弹簧(推向右侧)
        Rectangle { }

        // 未读徽章
        if account.unread-count > 0: Badge {
            count: account.unread-count;
            type: account.has-error ? "error" : "success";
        }
    }
}